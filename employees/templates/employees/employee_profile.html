{% extends 'core/base.html' %}
{% load static %}

{% block title %}My Profile | Petabytz{% endblock %}

{% block extra_css %}
<style>
    /* ... (Styles kept compact to save lines/tokens, verified they are good) ... */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
        --primary-hue: 245;
        --primary-color: hsl(var(--primary-hue), 80%, 60%);
        --primary-dark: hsl(var(--primary-hue), 80%, 50%);
        --primary-light: hsl(var(--primary-hue), 90%, 95%);
        --secondary-color: #64748b;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --bg-body: #f8fafc;
        --card-bg: #ffffff;
        --glass-bg: rgba(255, 255, 255, 0.7);
        --shadow-custom: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
        --radius-lg: 1.25rem;
        --radius-md: 0.75rem;
    }

    body {
        background-color: var(--bg-body);
        font-family: 'Inter', sans-serif;
        color: #1e293b;
    }

    .profile-hero {
        position: relative;
        height: 280px;
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        overflow: visible;
        border-bottom-left-radius: 2rem;
        border-bottom-right-radius: 2rem;
    }

    .profile-card-main {
        margin-top: -6rem;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid white;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-custom);
        padding: 2rem;
        position: relative;
        z-index: 10;
    }

    .profile-avatar-wrapper {
        position: relative;
        width: 130px;
        height: 130px;
        margin-top: 5rem;
        margin-bottom: 1rem;
        max-width: 100%;
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        min-width: 60px;
        min-height: 60px;
    }

    .profile-avatar {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
        border: 4px solid white;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        background-color: #cbd5e1;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }

    /* Ensure round shape is maintained */
    .profile-avatar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.2);
        pointer-events: none;
    }

    /* For placeholder avatar (no image) */
    .profile-avatar.placeholder {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        font-size: 2.5rem;
    }

    .camera-btn {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background: #1e293b;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        transition: all 0.2s ease;
        z-index: 10;
        min-width: 20px;
        min-height: 20px;
    }

    .camera-btn:hover {
        background: #374151;
        transform: scale(1.1);
    }

    .camera-btn i {
        font-size: 0.75rem;
        transition: font-size 0.2s ease;
    }

    .profile-name {
        font-weight: 700;
        font-size: 1.75rem;
        color: #1e293b;
        letter-spacing: -0.025em;
    }

    .profile-role {
        font-size: 0.95rem;
        color: var(--secondary-color);
        font-weight: 500;
    }

    .badge-soft {
        padding: 0.35em 0.8em;
        border-radius: 2rem;
        font-weight: 600;
        font-size: 0.75rem;
        letter-spacing: 0.02em;
    }

    .badge-soft-primary {
        background: var(--primary-light);
        color: var(--primary-dark);
    }

    .badge-soft-success {
        background: #d1fae5;
        color: #059669;
    }

    .nav-pills-custom {
        display: inline-flex;
        background: #f1f5f9;
        padding: 0.35rem;
        border-radius: 1rem;
        gap: 0.25rem;
        flex-wrap: wrap;
    }

    .nav-pills-custom .nav-link {
        color: #64748b;
        font-weight: 600;
        font-size: 0.9rem;
        padding: 0.6rem 1.5rem;
        border-radius: 0.75rem;
        transition: all 0.3s;
        white-space: nowrap;
        border: none;
        background: transparent;
    }

    .nav-pills-custom .nav-link.active {
        background: white;
        color: var(--primary-color);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .nav-pills-custom .nav-link:hover {
        background: rgba(255, 255, 255, 0.7);
        color: var(--primary-color);
    }
    
    /* Navigation responsive styles */
    @media (max-width: 991px) {
        .nav-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 1rem;
        }
        
        .nav-pills-custom {
            justify-content: center;
        }
    }
    
    @media (max-width: 767px) {
        .nav-pills-custom {
            width: 100%;
            justify-content: center;
            padding: 0.25rem;
            gap: 0.125rem;
        }
        
        .nav-pills-custom .nav-link {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            flex: 1;
            text-align: center;
            min-width: 0;
        }
    }
    
    @media (max-width: 575px) {
        .nav-pills-custom .nav-link {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }
    }
    
    @media (max-width: 400px) {
        .nav-pills-custom {
            flex-direction: column;
            width: 100%;
        }
        
        .nav-pills-custom .nav-link {
            width: 100%;
            margin-bottom: 0.25rem;
            padding: 0.6rem;
            text-align: center;
        }
        
        .nav-pills-custom .nav-link:last-child {
            margin-bottom: 0;
        }
    }

    .content-card {
        background: white;
        border-radius: var(--radius-md);
        border: 1px solid #f1f5f9;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
        height: 100%;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .card-header-clean {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-weight: 600;
        color: #334155;
        background: #fff;
        flex-wrap: wrap;
    }

    .card-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--primary-light);
        color: var(--primary-dark);
        border-radius: 8px;
        font-size: 0.9rem;
        flex-shrink: 0;
    }

    .card-body-clean {
        padding: 1.5rem;
    }
    
    /* Tab content responsive styles */
    @media (max-width: 991px) {
        .tab-content {
            margin-top: 2rem;
        }
        
        .row.g-4 {
            --bs-gutter-x: 1rem;
            --bs-gutter-y: 1rem;
        }
    }
    
    @media (max-width: 767px) {
        .tab-content {
            margin-top: 1.5rem;
        }
        
        .content-card {
            margin-bottom: 1rem;
            border-radius: 0.75rem;
        }
        
        .card-header-clean {
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
        }
        
        .card-body-clean {
            padding: 1.25rem;
        }
        
        .card-icon {
            width: 28px;
            height: 28px;
            font-size: 0.8rem;
        }
        
        /* Stack columns on mobile */
        .col-lg-5,
        .col-lg-7,
        .col-md-6,
        .col-md-12 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 1rem;
        }
        
        .row.g-4 {
            --bs-gutter-x: 0.75rem;
            --bs-gutter-y: 0.75rem;
        }
    }
    
    @media (max-width: 575px) {
        .card-header-clean {
            padding: 0.875rem 1rem;
            font-size: 0.85rem;
        }
        
        .card-body-clean {
            padding: 1rem;
        }
        
        .card-icon {
            width: 24px;
            height: 24px;
            font-size: 0.75rem;
        }
        
        .row.g-4 {
            --bs-gutter-x: 0.5rem;
            --bs-gutter-y: 0.5rem;
        }
    }

    .info-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #94a3b8;
        font-weight: 600;
        letter-spacing: 0.05em;
        margin-bottom: 0.25rem;
        display: block;
    }

    .info-value {
        font-size: 0.95rem;
        color: #1e293b;
        font-weight: 500;
        word-break: break-word;
        line-height: 1.4;
    }
    
    .info-group {
        background: #f8fafc;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        height: 100%;
        transition: 0.2s;
        margin-bottom: 0.75rem;
    }

    .info-group:hover {
        background: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
    }
    
    /* Info sections responsive */
    @media (max-width: 767px) {
        .info-group {
            padding: 0.625rem 0.875rem;
            margin-bottom: 0.75rem;
        }
        
        .info-label {
            font-size: 0.7rem;
            margin-bottom: 0.125rem;
        }
        
        .info-value {
            font-size: 0.875rem;
        }
        
        /* Stack info columns */
        .col-sm-6 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 0.75rem;
        }
    }
    
    @media (max-width: 575px) {
        .info-group {
            padding: 0.5rem 0.75rem;
        }
        
        .info-label {
            font-size: 0.65rem;
        }
        
        .info-value {
            font-size: 0.8rem;
        }
    }
    
    /* Address boxes responsive */
    .address-box {
        background: #fff;
        border: 1px solid #e2e8f0;
        padding: 1.25rem;
        border-radius: 1rem;
        height: 100%;
        margin-bottom: 1rem;
    }

    .address-header {
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
        color: #475569;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .address-text {
        font-size: 0.95rem;
        color: #334155;
        line-height: 1.6;
        margin: 0;
        word-break: break-word;
    }
    
    @media (max-width: 767px) {
        .address-box {
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .address-header {
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
        }
        
        .address-text {
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        /* Stack address columns */
        .col-md-6 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 1rem;
        }
    }
    
    @media (max-width: 575px) {
        .address-box {
            padding: 0.875rem;
        }
        
        .address-header {
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .address-text {
            font-size: 0.8rem;
        }
    }

    .timeline-wrapper {
        position: relative;
        padding-left: 1rem;
    }

    .timeline-line {
        position: absolute;
        top: 0.5rem;
        bottom: 0;
        left: 23px;
        width: 2px;
        background: #e2e8f0;
    }

    .timeline-node {
        position: relative;
        padding-left: 3rem;
        margin-bottom: 2rem;
    }

    .timeline-node:last-child {
        margin-bottom: 0;
    }

    .timeline-dot {
        width: 20px;
        height: 20px;
        left: 15px;
        border-width: 3px;
        position: absolute;
        top: 0;
        background: white;
        border: 2px solid #cbd5e1;
        border-radius: 50%;
        z-index: 2;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .timeline-dot.active {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px var(--primary-light);
    }

    .timeline-dot-inner {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #cbd5e1;
    }

    .timeline-dot.active .timeline-dot-inner {
        background: var(--primary-color);
    }

    .timeline-dot.pulsing::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        border-radius: 50%;
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.3);
        animation: pulse-ring 2s infinite;
    }

    @keyframes pulse-ring {
        0% {
            transform: scale(1);
            opacity: 0.8;
        }

        100% {
            transform: scale(2.5);
            opacity: 0;
        }
    }

    .timeline-content {
        padding: 1.25rem;
        background: #fff;
        border-radius: 1rem;
        border: 1px solid #f1f5f9;
        transition: 0.2s;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        margin-left: 0.5rem;
    }

    .timeline-content.active-node {
        background: #fcfaff;
        border-color: var(--primary-light);
    }

    .timeline-date {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--secondary-color);
        margin-bottom: 0.25rem;
        display: block;
    }

    .timeline-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: #334155;
    }

    .doc-upload-box {
        border: 2px dashed #cbd5e1;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        transition: 0.2s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .doc-upload-box:hover {
        border-color: var(--primary-color);
        background: #f8fafc;
    }

    .doc-preview-img {
        max-height: 120px;
        object-fit: cover;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
    }

    .doc-status-badge {
        position: absolute;
        top: 10px;
        right: 10px;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in-up {
        opacity: 0;
        animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    .gradient-icon {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
    }

    .gradient-icon-2 {
        background: linear-gradient(135deg, #3b82f6, #06b6d4);
        color: white;
        border: none;
    }

    .gradient-icon-3 {
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        color: white;
        border: none;
    }

    .info-group {
        background: #f8fafc;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        height: 100%;
        transition: 0.2s;
    }

    .info-group:hover {
        background: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
    }

    .bg-primary-soft {
        background-color: #e0e7ff;
        color: #4338ca;
    }

    .address-box {
        background: #fff;
        border: 1px solid #e2e8f0;
        padding: 1.25rem;
        border-radius: 1rem;
        height: 100%;
    }

    .address-header {
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
        color: #475569;
    }

    .address-text {
        font-size: 0.95rem;
        color: #334155;
        line-height: 1.6;
        margin: 0;
    }
    
    /* Form responsive styles */
    @media (max-width: 767px) {
        .form-control,
        .form-select {
            font-size: 16px !important; /* Prevents zoom on iOS */
            padding: 0.75rem;
            border-radius: 0.5rem;
            min-height: 44px;
        }
        
        .form-label {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.375rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            min-height: 44px;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            min-height: 36px;
        }
        
        /* Form grid responsive */
        .row.g-3 > .col-md-6,
        .row.g-3 > .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 0.75rem;
        }
        
        .row.g-2 > .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 0.5rem;
        }
    }
    
    @media (max-width: 575px) {
        .form-control,
        .form-select {
            padding: 0.625rem;
            font-size: 16px !important;
        }
        
        .btn {
            padding: 0.625rem 1.25rem;
            font-size: 0.8rem;
        }
        
        .form-label {
            font-size: 0.75rem;
        }
    }
    
    /* Emergency contacts responsive */
    @media (max-width: 767px) {
        .border.rounded-3 {
            padding: 1rem !important;
            margin-bottom: 0.75rem;
        }
        
        .border.rounded-3 h6 {
            font-size: 0.9rem;
        }
        
        .border.rounded-3 .small {
            font-size: 0.8rem;
        }
        
        .border.rounded-3 .badge {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
        }
    }
    
    @media (max-width: 575px) {
        .border.rounded-3 {
            padding: 0.875rem !important;
        }
        
        .border.rounded-3 h6 {
            font-size: 0.85rem;
        }
        
        .border.rounded-3 .small {
            font-size: 0.75rem;
        }
    }
    
    /* Document upload responsive */
    .doc-upload-box {
        border: 2px dashed #cbd5e1;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        transition: 0.2s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .doc-upload-box:hover {
        border-color: var(--primary-color);
        background: #f8fafc;
    }

    .doc-preview-img {
        max-height: 120px;
        object-fit: cover;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
        max-width: 100%;
    }

    .doc-status-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 10;
    }
    
    @media (max-width: 767px) {
        .doc-upload-box {
            padding: 1.25rem;
            border-radius: 0.5rem;
            min-height: 100px;
        }
        
        .doc-preview-img {
            max-height: 100px;
        }
        
        .doc-status-badge {
            top: 8px;
            right: 8px;
            font-size: 0.7rem;
        }
        
        /* Stack document columns */
        .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 1rem;
        }
    }
    
    @media (max-width: 575px) {
        .doc-upload-box {
            padding: 1rem;
            min-height: 80px;
        }
        
        .doc-preview-img {
            max-height: 80px;
        }
        
        .doc-status-badge {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
        }
    }
    
    /* Job tab responsive */
    @media (max-width: 767px) {
        /* Employment details responsive */
        .col-sm-6 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 1rem;
        }
        
        /* Reporting hierarchy responsive */
        .d-inline-flex {
            width: 80px;
            height: 80px;
        }
        
        .d-inline-flex span {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 575px) {
        .d-inline-flex {
            width: 60px;
            height: 60px;
        }
        
        .d-inline-flex span {
            font-size: 1.2rem;
        }
    }

    /* === COMPREHENSIVE RESPONSIVE DESIGN FOR ALL DEVICES === */
    
    /* Base responsive adjustments */
    .container {
        max-width: 100%;
        padding-left: 15px;
        padding-right: 15px;
    }
    
    /* Profile hero responsive */
    .profile-hero {
        height: 200px;
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    }
    
    /* Profile card responsive */
    .profile-card-main {
        margin-top: -4rem;
        padding: 2rem;
        border-radius: 1.25rem;
        box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
    }
    
    /* === LARGE DESKTOP (1400px+) === */
    @media (min-width: 1400px) {
        .profile-hero {
            height: 320px;
        }
        
        .profile-card-main {
            margin-top: -7rem;
            padding: 2.5rem;
        }
        
        .profile-avatar-wrapper {
            width: 150px;
            height: 150px;
            margin-top: -6rem;
        }
        
        .profile-avatar.placeholder {
            font-size: 3rem;
        }
        
        .camera-btn {
            width: 36px;
            height: 36px;
            bottom: 8px;
            right: 8px;
        }
        
        .camera-btn i {
            font-size: 0.9rem;
        }
        
        .profile-name {
            font-size: 2rem;
        }
        
        .profile-role {
            font-size: 1.1rem;
        }
    }
    
    /* === DESKTOP (1200px - 1399px) === */
    @media (max-width: 1399px) and (min-width: 1200px) {
        .profile-hero {
            height: 280px;
        }
        
        .profile-avatar-wrapper {
            width: 130px;
            height: 130px;
            margin-top: -5.5rem;
        }
        
        .profile-avatar.placeholder {
            font-size: 2.5rem;
        }
        
        .camera-btn {
            width: 32px;
            height: 32px;
            bottom: 6px;
            right: 6px;
        }
        
        .camera-btn i {
            font-size: 0.8rem;
        }
    }
    
    /* === LAPTOP (992px - 1199px) === */
    @media (max-width: 1199px) and (min-width: 992px) {
        .profile-hero {
            height: 250px;
        }
        
        .profile-card-main {
            margin-top: -4.5rem;
            padding: 1.75rem;
        }
        
        .profile-avatar-wrapper {
            width: 120px;
            height: 120px;
            margin-top: -4.5rem;
        }
        
        .profile-avatar.placeholder {
            font-size: 2.2rem;
        }
        
        .camera-btn {
            width: 30px;
            height: 30px;
            bottom: 4px;
            right: 4px;
        }
        
        .camera-btn i {
            font-size: 0.75rem;
        }
        
        .profile-name {
            font-size: 1.6rem;
        }
        
        .profile-role {
            font-size: 0.95rem;
        }
    }
    
    /* === TABLET (768px - 991px) === */
    @media (max-width: 991px) and (min-width: 768px) {
        .profile-hero {
            height: 220px;
        }
        
        .profile-card-main {
            margin-top: -4rem;
            padding: 1.5rem;
        }
        
        .profile-avatar-wrapper {
            width: 110px;
            height: 110px;
            margin-top: -4rem;
            margin-bottom: 1rem;
        }
        
        .profile-avatar {
            border-width: 3px;
        }
        
        .profile-avatar.placeholder {
            font-size: 2rem;
        }
        
        .camera-btn {
            width: 28px;
            height: 28px;
            bottom: 3px;
            right: 3px;
        }
        
        .camera-btn i {
            font-size: 0.7rem;
        }
        
        .profile-name {
            font-size: 1.5rem;
        }
        
        .profile-role {
            font-size: 0.9rem;
        }
        
        /* Adjust layout for tablet */
        .row.align-items-end {
            align-items: center !important;
            text-align: center;
        }
        
        .nav-pills-custom {
            justify-content: center;
            margin-top: 1rem;
        }
    }
    
    /* === MOBILE LARGE (576px - 767px) === */
    @media (max-width: 767px) and (min-width: 576px) {
        .profile-hero {
            height: 180px;
        }
        
        .profile-card-main {
            margin-top: -3.5rem;
            padding: 1.25rem;
            border-radius: 1rem;
        }
        
        .profile-avatar-wrapper {
            width: 100px;
            height: 100px;
            margin-top: -3.5rem;
            margin-bottom: 1rem;
            margin-left: auto;
            margin-right: auto;
        }
        
        .profile-avatar {
            border-width: 3px;
        }
        
        .profile-avatar.placeholder {
            font-size: 1.8rem;
        }
        
        .camera-btn {
            width: 26px;
            height: 26px;
            bottom: 2px;
            right: 2px;
        }
        
        .camera-btn i {
            font-size: 0.65rem;
        }
        
        .profile-name {
            font-size: 1.4rem;
            text-align: center;
        }
        
        .profile-role {
            font-size: 0.85rem;
            text-align: center;
        }
        
        /* Center all profile content */
        .row.align-items-end {
            align-items: center !important;
            text-align: center;
        }
        
        .row.align-items-end > div {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .nav-pills-custom {
            justify-content: center;
            margin-top: 1rem;
        }
        
        /* Stack badges vertically */
        .d-flex.gap-3 {
            flex-direction: column;
            gap: 0.5rem !important;
            align-items: center;
        }
        
        /* Responsive tabs */
        .nav-pills-custom {
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .nav-pills-custom .nav-link {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
    }
    
    /* === MOBILE MEDIUM (400px - 575px) === */
    @media (max-width: 575px) and (min-width: 400px) {
        .container {
            padding-left: 10px;
            padding-right: 10px;
        }
        
        .profile-hero {
            height: 160px;
        }
        
        .profile-card-main {
            margin-top: -3rem;
            padding: 1rem;
            border-radius: 0.75rem;
        }
        
        .profile-avatar-wrapper {
            width: 90px;
            height: 90px;
            margin-top: -3rem;
            margin-bottom: 0.75rem;
        }
        
        .profile-avatar {
            border-width: 2px;
        }
        
        .profile-avatar.placeholder {
            font-size: 1.6rem;
        }
        
        .camera-btn {
            width: 24px;
            height: 24px;
            bottom: 1px;
            right: 1px;
        }
        
        .camera-btn i {
            font-size: 0.6rem;
        }
        
        .profile-name {
            font-size: 1.25rem;
            text-align: center;
        }
        
        .profile-role {
            font-size: 0.8rem;
            text-align: center;
        }
        
        /* Compact navigation */
        .nav-pills-custom .nav-link {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }
        
        /* Compact badges */
        .badge-soft {
            padding: 0.25em 0.6em;
            font-size: 0.7rem;
        }
    }
    
    /* === MOBILE SMALL (320px - 399px) === */
    @media (max-width: 399px) and (min-width: 320px) {
        .container {
            padding-left: 8px;
            padding-right: 8px;
        }
        
        .profile-hero {
            height: 140px;
        }
        
        .profile-card-main {
            margin-top: -2.5rem;
            padding: 0.875rem;
            border-radius: 0.75rem;
        }
        
        .profile-avatar-wrapper {
            width: 80px;
            height: 80px;
            margin-top: -2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .profile-avatar {
            border-width: 2px;
        }
        
        .profile-avatar.placeholder {
            font-size: 1.4rem;
        }
        
        .camera-btn {
            width: 22px;
            height: 22px;
            bottom: 0;
            right: 0;
        }
        
        .camera-btn i {
            font-size: 0.55rem;
        }
        
        .profile-name {
            font-size: 1.1rem;
            text-align: center;
        }
        
        .profile-role {
            font-size: 0.75rem;
            text-align: center;
        }
        
        /* Very compact navigation */
        .nav-pills-custom {
            padding: 0.25rem;
            gap: 0.25rem;
        }
        
        .nav-pills-custom .nav-link {
            padding: 0.35rem 0.6rem;
            font-size: 0.75rem;
        }
    }
    
    /* === FLEXIBLE GRID SYSTEM FOR ALL DEVICES === */
    
    /* Container queries for modern browsers */
    @container (max-width: 600px) {
        .profile-layout {
            flex-direction: column;
            text-align: center;
        }
        
        .profile-avatar-wrapper {
            margin: 0 auto 1rem;
        }
        
        .nav-pills-custom {
            justify-content: center;
            margin-top: 1rem;
        }
    }
    
    /* Flexible content areas */
    .content-area {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 767px) {
        .content-area {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
    }
    
    @media (max-width: 575px) {
        .content-area {
            gap: 0.5rem;
        }
    }
    
    /* Flexible card layouts */
    .card-grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 767px) {
        .card-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
    }
    
    /* Flexible info sections */
    .info-grid {
        display: grid;
        gap: 0.75rem;
        grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 575px) {
        .info-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
    }
    
    /* Flexible address layout */
    .address-grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 767px) {
        .address-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
    }
    
    /* Flexible document upload grid */
    .doc-grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 767px) {
        .doc-grid {
            grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
            gap: 0.75rem;
        }
    }
    
    @media (max-width: 575px) {
        .doc-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
    }
    
    /* Flexible emergency contacts */
    .contacts-grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 767px) {
        .contacts-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
    }
    
    /* Flexible form layouts */
    .form-grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 767px) {
        .form-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
    }
    
    .form-grid-2 {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
        width: 100%;
    }
    
    @media (max-width: 575px) {
        .form-grid-2 {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
    }
    
    /* === EXTRA SMALL SCREENS (< 320px) === */
    @media (max-width: 319px) {
        .container {
            padding-left: 5px;
            padding-right: 5px;
        }
        
        .profile-hero {
            height: 120px;
        }
        
        .profile-card-main {
            margin-top: -2rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        
        .profile-avatar-wrapper {
            width: 70px;
            height: 70px;
            margin-top: -2rem;
            margin-bottom: 0.5rem;
        }
        
        .profile-avatar {
            border-width: 2px;
        }
        
        .profile-avatar.placeholder {
            font-size: 1.2rem;
        }
        
        .camera-btn {
            width: 20px;
            height: 20px;
            bottom: 0;
            right: 0;
        }
        
        .camera-btn i {
            font-size: 0.5rem;
        }

        
    .profile-avatar.placeholder {
        opacity: 1;           /* Bootstrap fix */
    }
        
        .profile-name {
            font-size: 1rem;
            text-align: center;
        }
        
        .profile-role {
            font-size: 0.7rem;
            text-align: center;
        }
        
        /* Minimal navigation */
        .nav-pills-custom .nav-link {
            padding: 0.3rem 0.5rem;
            font-size: 0.7rem;
        }
        
        /* Force all grids to single column */
        .content-area,
        .card-grid,
        .info-grid,
        .address-grid,
        .doc-grid,
        .contacts-grid,
        .form-grid,
        .form-grid-2 {
            grid-template-columns: 1fr !important;
            gap: 0.25rem !important;
        }
    }
    
    /* === ULTRA FLEXIBLE GRID SYSTEM === */
    
    /* Ensure grids never overflow */
    .content-area,
    .card-grid,
    .info-grid,
    .address-grid,
    .doc-grid,
    .contacts-grid,
    .form-grid,
    .form-grid-2 {
        max-width: 100%;
        overflow: hidden;
        box-sizing: border-box;
    }
    
    /* Prevent grid items from overflowing */
    .content-area > *,
    .card-grid > *,
    .info-grid > *,
    .address-grid > *,
    .doc-grid > *,
    .contacts-grid > *,
    .form-grid > *,
    .form-grid-2 > * {
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
    }
    
    /* Flexible content cards */
    .content-card {
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
        word-wrap: break-word;
        hyphens: auto;
    }
    
    /* Flexible info groups */
    .info-group {
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
    }
    
    .info-value {
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
    }
    
    /* Flexible address boxes */
    .address-box {
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
    }
    
    .address-text {
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
    }
    
    /* Flexible document upload boxes */
    .doc-upload-box {
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
    }
    
    /* Flexible form controls */
    .form-control,
    .form-select {
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
    }
    
    /* === LANDSCAPE ORIENTATION ADJUSTMENTS === */
    @media (max-width: 896px) and (orientation: landscape) and (max-height: 500px) {
        .profile-hero {
            height: 120px;
        }
        
        .profile-card-main {
            margin-top: -2.5rem;
            padding: 1rem;
        }
        
        .profile-avatar-wrapper {
            width: 85px;
            height: 85px;
            margin-top: -2.5rem;
        }
        
        .profile-avatar.placeholder {
            font-size: 1.5rem;
        }
        
        .camera-btn {
            width: 24px;
            height: 24px;
        }
        
        /* Horizontal layout for landscape */
        .row.align-items-end {
            align-items: center !important;
        }
        
        .nav-pills-custom {
            flex-direction: row;
            justify-content: center;
        }
    }
    
    /* === CONTENT AREA RESPONSIVE ADJUSTMENTS === */
    
    /* Timeline responsive */
    @media (max-width: 767px) {
        .timeline-wrapper {
            padding-left: 0.5rem;
        }
        
        .timeline-line {
            left: 18px;
        }
        
        .timeline-dot {
            width: 16px;
            height: 16px;
            left: 10px;
        }
        
        .timeline-dot-inner {
            width: 6px;
            height: 6px;
        }
        
        .timeline-node {
            padding-left: 2.5rem;
            margin-bottom: 1.5rem;
        }
        
        .timeline-content {
            padding: 1rem;
            margin-left: 0.25rem;
        }
        
        .timeline-title {
            font-size: 0.9rem;
        }
        
        .timeline-date {
            font-size: 0.7rem;
        }
    }
    
    /* Cards responsive */
    @media (max-width: 767px) {
        .content-card {
            margin-bottom: 1rem;
            border-radius: 0.75rem;
        }
        
        .card-header-clean {
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
        }
        
        .card-body-clean {
            padding: 1.25rem;
        }
        
        .card-icon {
            width: 28px;
            height: 28px;
            font-size: 0.8rem;
        }
    }
    
    @media (max-width: 575px) {
        .card-header-clean {
            padding: 0.875rem 1rem;
            font-size: 0.85rem;
        }
        
        .card-body-clean {
            padding: 1rem;
        }
        
        .card-icon {
            width: 24px;
            height: 24px;
            font-size: 0.75rem;
        }
    }
    
    /* Info groups responsive */
    @media (max-width: 767px) {
        .info-group {
            padding: 0.625rem 0.875rem;
            margin-bottom: 0.75rem;
        }
        
        .info-label {
            font-size: 0.7rem;
            margin-bottom: 0.125rem;
        }
        
        .info-value {
            font-size: 0.875rem;
        }
    }
    
    /* Address boxes responsive */
    @media (max-width: 767px) {
        .address-box {
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .address-header {
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
        }
        
        .address-text {
            font-size: 0.875rem;
            line-height: 1.5;
        }
    }
    
    /* Document upload responsive */
    @media (max-width: 767px) {
        .doc-upload-box {
            padding: 1.25rem;
            border-radius: 0.5rem;
        }
        
        .doc-preview-img {
            max-height: 100px;
        }
        
        .doc-status-badge {
            top: 8px;
            right: 8px;
            font-size: 0.7rem;
        }
    }
    
    @media (max-width: 575px) {
        .doc-upload-box {
            padding: 1rem;
        }
        
        .doc-preview-img {
            max-height: 80px;
        }
    }
    
    /* Form responsive adjustments */
    @media (max-width: 767px) {
        .form-control,
        .form-select {
            font-size: 16px; /* Prevents zoom on iOS */
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        
        .form-label {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.375rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }
    }
    
    /* Emergency contacts responsive */
    @media (max-width: 767px) {
        .border.rounded-3 {
            padding: 1rem !important;
            margin-bottom: 0.75rem;
        }
        
        .border.rounded-3 h6 {
            font-size: 0.9rem;
        }
        
        .border.rounded-3 .small {
            font-size: 0.8rem;
        }
    }
    
    /* === HIGH DPI DISPLAYS === */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .profile-avatar {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
    }
    
    /* === CONTAINER QUERIES (MODERN BROWSERS) === */
    @container (max-width: 300px) {
        .profile-avatar-wrapper {
            width: 60px;
            height: 60px;
        }
        
        .profile-avatar.placeholder {
            font-size: 1rem;
        }
        
        .camera-btn {
            width: 18px;
            height: 18px;
        }
    }
    
    /* === TOUCH DEVICE OPTIMIZATIONS === */
    @media (hover: none) and (pointer: coarse) {
        .camera-btn {
            min-width: 44px;
            min-height: 44px;
        }
        
        .nav-pills-custom .nav-link {
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn {
            min-height: 44px;
        }
        
        .doc-upload-box {
            min-height: 44px;
        }
    }
    
    /* === ACCESSIBILITY IMPROVEMENTS === */
    @media (prefers-reduced-motion: reduce) {
        .profile-avatar,
        .camera-btn,
        .nav-link,
        .timeline-content {
            transition: none !important;
        }
        
        .fade-in-up {
            animation: none !important;
        }
    }
    
    @media (prefers-contrast: high) {
        .profile-card-main,
        .content-card,
        .info-group,
        .address-box {
            border: 2px solid #000;
        }
        
        .nav-pills-custom .nav-link {
            border: 1px solid;
        }
    }
    
    /* === PRINT STYLES === */
    @media print {
        .profile-hero {
            height: auto;
            background: none !important;
        }
        
        .profile-card-main {
            margin-top: 0;
            box-shadow: none;
            border: 1px solid #000;
        }
        
        .camera-btn,
        .nav-pills-custom,
        .btn {
            display: none !important;
        }
        
        .profile-avatar-wrapper {
            position: static;
            margin: 0 auto 1rem;
        }
        
        .timeline-content {
            box-shadow: none;
            border: 1px solid #ccc;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-hero"></div>

<div class="container pb-5">
    <div class="profile-card-main">
        <div class="profile-layout row align-items-end">
            <div class="col-lg-2 col-md-3">
                <div class="profile-avatar-wrapper" onclick="document.getElementById('profile_pic_input').click()"
                    title="Click to change profile picture">
                    {% if employee.profile_picture %}
                    <img src="{{ employee.profile_picture.url }}" class="profile-avatar" alt="Profile">
                    {% else %}
                    <div class="profile-avatar placeholder d-flex align-items-center justify-content-center text-white">
                        <i class="fas fa-user"></i>
                    </div>
                    {% endif %}
                    <div class="camera-btn"><i class="fas fa-camera"></i></div>
                </div>
            </div>

            <div class="col-lg-6 col-md-5 mb-3 mb-md-0">
                <h1 class="profile-name mb-1">
                    {{ employee.user.get_full_name }}
                </h1>
                <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                    <span class="profile-role"><i class="fas fa-briefcase me-1 text-muted"></i>
                        {{ employee.designation }}
                    </span>
                    <span class="text-muted">â€¢</span>
                    <span class="profile-role"><i class="fas fa-building me-1 text-muted"></i>
                        {{ employee.department }}
                    </span>
                </div>
                <div class="d-flex gap-3 flex-wrap">
                    <div class="badge-soft badge-soft-primary">
                        {{ employee.get_work_type_display|default:"Full Time" }}
                    </div>
                    <div class="d-flex align-items-center text-muted small"><i class="fas fa-id-badge me-1"></i>
                        {{ employee.badge_id|default:"-" }}
                    </div>
                    <div class="d-flex align-items-center text-muted small"><i class="fas fa-map-marker-alt me-1"></i>
                        {{ employee.location.name|default:"Remote" }}
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-4 text-md-end">
                <div class="d-inline-block text-start text-md-end mb-3">
                    <div class="small text-muted mb-1 text-uppercase fw-bold" style="font-size: 0.7rem;">Current Status
                    </div>
                    {% if employee.is_active %}
                    <span class="badge bg-success rounded-pill px-3 py-2 shadow-sm"><i
                            class="fas fa-check-circle me-1"></i> Active</span>
                    {% else %}
                    <span class="badge bg-danger rounded-pill px-3 py-2 shadow-sm"><i
                            class="fas fa-times-circle me-1"></i> Inactive</span>
                    {% endif %}
                </div>
                <div class="nav-container">
                    <ul class="nav nav-pills-custom justify-content-md-end" id="profileTabs" role="tablist">
                        <li class="nav-item"><button class="nav-link active" id="about-tab" data-bs-toggle="tab"
                                data-bs-target="#about" type="button" role="tab">About</button></li>
                        <li class="nav-item"><button class="nav-link" id="job-tab" data-bs-toggle="tab"
                                data-bs-target="#job" type="button" role="tab">Job</button></li>
                        <li class="nav-item"><button class="nav-link" id="docs-tab" data-bs-toggle="tab"
                                data-bs-target="#docs" type="button" role="tab">Docs</button></li>
                    </ul>
                </div>
            </div>
        </div>
        <input type="file" id="profile_pic_input" class="d-none" form="avatar-form" name="profile_picture"
            accept="image/*" onchange="document.getElementById('avatar-form').submit()">
        <form id="avatar-form" method="post" enctype="multipart/form-data" class="d-none">{% csrf_token %}</form>
    </div>

    <div class="tab-content mt-4" id="profileTabsContent">

        <!-- ABOUT TAB -->
        <div class="tab-pane fade show active" id="about" role="tabpanel">
            <div class="content-area">
                <!-- Work Timeline -->
                <div class="fade-in-up" style="animation-delay: 0.1s;">
                    <div class="content-card h-100">
                        <div class="card-header-clean">
                            <div class="card-icon gradient-icon"><i class="fas fa-history"></i></div>Work Timeline
                        </div>
                        <div class="card-body-clean">
                            <div class="timeline-wrapper">
                                <div class="timeline-line"></div>

                                <!-- Present -->
                                <div class="timeline-node">
                                    <div class="timeline-dot pulsing">
                                        <div class="timeline-dot-inner"></div>
                                    </div>
                                    <div class="timeline-content active-node">
                                        <span class="timeline-date">Today</span>
                                        <div class="timeline-title text-primary">Current Role</div>
                                        <span class="badge bg-primary-soft text-primary mt-1">
                                            {{ employee.designation }}
                                        </span>
                                    </div>
                                </div>

                                <!-- Probation Status (only show if completed) -->
                                {% if probation_status == 'COMPLETED' or probation_status == 'COMPLETED_TODAY' %}
                                <div class="timeline-node">
                                    <div
                                        class="timeline-dot {% if employee.employment_status == 'ACTIVE' %}active{% endif %}">
                                        <div class="timeline-dot-inner"></div>
                                    </div>
                                    <div class="timeline-content">
                                        <span class="timeline-date">{{ probation_date|date:"d M, Y" }}</span>
                                        <div class="timeline-title">
                                            {% if probation_status == 'COMPLETED_TODAY' %}
                                                <span class="text-success">ðŸŽ‰ Probation Completed</span>
                                            {% else %}
                                                Probation Completed
                                            {% endif %}
                                        </div>
                                        <div class="small text-muted">Confirmed Employee</div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Joined -->
                                <div class="timeline-node">
                                    <div class="timeline-dot active">
                                        <div class="timeline-dot-inner"></div>
                                    </div>
                                    <div class="timeline-content">
                                        <span class="timeline-date">
                                            {{ employee.date_of_joining|date:"d M, Y"|default:"-" }}
                                        </span>
                                        <div class="timeline-title">Joined Organization</div>
                                        <div class="small text-muted">
                                            {{ employee.designation }} â€¢ {{ employee.department }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personal Info & Addresses -->
                <div class="fade-in-up" style="animation-delay: 0.2s;">
                    {% if not employee.profile_edited %}
                    <div class="content-card">
                        <div class="card-header-clean">
                            <div class="card-icon gradient-icon-2"><i class="fas fa-user-edit"></i></div>
                            Complete Your Profile
                        </div>
                        <div class="card-body-clean">
                            <div class="alert alert-info border-0 bg-soft-info text-dark mb-4">
                                <i class="fas fa-info-circle me-2"></i>
                                You can edit your personal details, address, and emergency contacts <strong>only
                                    once</strong>. Please ensure all information is correct before saving.
                            </div>

                            <form method="post" action="{% url 'employee_profile' %}">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="update_profile">

                                <h6 class="fw-bold mb-3 text-primary">Personal Details</h6>
                                <div class="form-grid mb-4">
                                    <div>
                                        <label class="form-label small fw-bold text-muted">Mobile Number</label>
                                        <input type="text" name="mobile_number" class="form-control"
                                            value="{{ employee.mobile_number|default:'' }}" required>
                                    </div>
                                    <div>
                                        <label class="form-label small fw-bold text-muted">Date of Birth</label>
                                        <input type="date" name="dob" class="form-control"
                                            value="{{ employee.dob|date:'Y-m-d' }}" required>
                                    </div>
                                    <div>
                                        <label class="form-label small fw-bold text-muted">Gender</label>
                                        <select name="gender" class="form-select" required>
                                            <option value="">Select Gender</option>
                                            <option value="M" {% if employee.gender == 'M' %}selected{% endif %}>Male
                                            </option>
                                            <option value="F" {% if employee.gender == 'F' %}selected{% endif %}>Female
                                            </option>
                                            <option value="O" {% if employee.gender == 'O' %}selected{% endif %}>Other
                                            </option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label small fw-bold text-muted">Marital Status</label>
                                        <select name="marital_status" class="form-select" required>
                                            <option value="">Select Status</option>
                                            <option value="S" {% if employee.marital_status == 'S' %}selected{% endif %}>
                                                Single</option>
                                            <option value="M" {% if employee.marital_status == 'M' %}selected{% endif %}>
                                                Married</option>
                                            <option value="D" {% if employee.marital_status == 'D' %}selected{% endif %}>
                                                Divorced</option>
                                            <option value="W" {% if employee.marital_status == 'W' %}selected{% endif %}>
                                                Widowed</option>
                                        </select>
                                    </div>
                                </div>

                                <h6 class="fw-bold mb-3 text-primary">Address Book</h6>
                                <div class="row g-3 mb-4">
                                    <div class="col-12">
                                        <label class="form-label small fw-bold text-muted">Current Address</label>
                                        <textarea name="current_address" class="form-control" rows="2"
                                            required>{{ employee.current_address|default:'' }}</textarea>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small fw-bold text-muted">Permanent Address</label>
                                        <textarea name="permanent_address" class="form-control" rows="2"
                                            required>{{ employee.permanent_address|default:'' }}</textarea>
                                    </div>
                                </div>

                                <h6 class="fw-bold mb-3 text-primary">Emergency Contacts</h6>
                                <div class="contacts-grid mb-3">
                                    <div>
                                        <div class="p-3 border rounded bg-light">
                                            <label class="small fw-bold text-muted mb-2">Primary Contact</label>
                                            <div class="form-grid-2">
                                                <div>
                                                    <input type="text" name="contact_name_1"
                                                        class="form-control form-control-sm" placeholder="Name"
                                                        required>
                                                </div>
                                                <div>
                                                    <input type="text" name="contact_phone_1"
                                                        class="form-control form-control-sm" placeholder="Phone"
                                                        required>
                                                </div>
                                                <div>
                                                    <input type="text" name="contact_rel_1"
                                                        class="form-control form-control-sm" placeholder="Relationship"
                                                        required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="p-3 border rounded bg-light">
                                            <label class="small fw-bold text-muted mb-2">Secondary Contact
                                                (Optional)</label>
                                            <div class="form-grid-2">
                                                <div>
                                                    <input type="text" name="contact_name_2"
                                                        class="form-control form-control-sm" placeholder="Name">
                                                </div>
                                                <div>
                                                    <input type="text" name="contact_phone_2"
                                                        class="form-control form-control-sm" placeholder="Phone">
                                                </div>
                                                <div>
                                                    <input type="text" name="contact_rel_2"
                                                        class="form-control form-control-sm" placeholder="Relationship">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end mt-4">
                                    <button type="submit" class="btn btn-primary px-4">
                                        <i class="fas fa-save me-2"></i>Save Details
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    {% else %}
                    <div class="row g-4">
                        <div class="col-md-12 fade-in-up" style="animation-delay: 0.2s;">
                            <div class="content-card">
                                <div class="card-header-clean">
                                    <div class="card-icon gradient-icon-2"><i class="fas fa-user-circle"></i></div>
                                    Personal Details
                                </div>
                                <div class="card-body-clean">
                                    <div class="row g-3">
                                        <div class="col-sm-6">
                                            <div class="info-group"><label class="info-label">Full Name</label>
                                                <div class="info-value fw-bold">
                                                    {{ employee.user.get_full_name }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="info-group"><label class="info-label">Email</label>
                                                <div class="info-value text-break">
                                                    {{ employee.user.email }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="info-group"><label class="info-label">Phone</label>
                                                <div class="info-value">
                                                    {{ employee.mobile_number|default:"--" }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="info-group"><label class="info-label">Date of Birth</label>
                                                <div class="info-value">
                                                    {{ employee.dob|date:"d M, Y"|default:"--" }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="info-group"><label class="info-label">Gender</label>
                                                <div class="info-value">
                                                    {{ employee.get_gender_display|default:"--" }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="info-group"><label class="info-label">Marital Status</label>
                                                <div class="info-value">
                                                    {{ employee.get_marital_status_display|default:"--" }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12 fade-in-up" style="animation-delay: 0.3s;">
                            <div class="content-card">
                                <div class="card-header-clean">
                                    <div class="card-icon gradient-icon-3"><i class="fas fa-map-marker-alt"></i></div>
                                    Address Book
                                </div>
                                <div class="card-body-clean">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="address-box">
                                                <div class="address-header"><i
                                                        class="fas fa-home me-2 text-primary"></i> Current Address</div>
                                                <p class="address-text">
                                                    {{ employee.current_address|default:"Not Provided"|linebreaksbr }}
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="address-box">
                                                <div class="address-header"><i
                                                        class="fas fa-building me-2 text-secondary"></i> Permanent
                                                    Address</div>
                                                <p class="address-text">
                                                    {{ employee.permanent_address|default:"-"|linebreaksbr }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contacts Section -->
                        <div class="col-md-12 fade-in-up" style="animation-delay: 0.4s;">
                            <div class="content-card">
                                <div class="card-header-clean">
                                    <div class="card-icon"
                                        style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white;">
                                        <i class="fas fa-phone-alt"></i>
                                    </div>
                                    Emergency Contacts
                                </div>
                                <div class="card-body-clean">
                                    {% if emergency_contacts %}
                                    <div class="row g-3">
                                        {% for contact in emergency_contacts %}
                                        <div class="col-md-6">
                                            <div class="border rounded-3 p-3 h-100"
                                                style="background: #f8fafc; transition: all 0.3s;">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <h6 class="mb-0 fw-bold text-dark">
                                                        <i class="fas fa-user-circle me-2 text-primary"></i>
                                                        {{ contact.name }}
                                                    </h6>
                                                    {% if contact.is_primary %}
                                                    <span class="badge bg-success"
                                                        style="font-size: 0.7rem;">Primary</span>
                                                    {% endif %}
                                                </div>
                                                <div class="small text-muted mb-1">
                                                    <i class="fas fa-phone me-2 text-success"></i>
                                                    <a href="tel:{{ contact.phone_number }}"
                                                        class="text-decoration-none text-dark fw-medium">
                                                        {{ contact.phone_number }}
                                                    </a>
                                                </div>
                                                <div class="small text-muted">
                                                    <i class="fas fa-user-friends me-2 text-info"></i>
                                                    {{ contact.relationship }}
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% else %}
                                    <div class="text-center py-5 text-muted">
                                        <i class="fas fa-phone-slash fa-3x mb-3 opacity-25"></i>
                                        <p class="mb-0">No emergency contacts added yet.</p>
                                        <p class="small">Contact your HR to add emergency contacts.</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- JOB TAB -->
        <div class="tab-pane fade" id="job" role="tabpanel">
            <div class="card-grid">
                <div>
                    <div class="content-card">
                        <div class="card-header-clean">
                            <div class="card-icon"><i class="fas fa-briefcase"></i></div>Employment Details
                        </div>
                        <div class="card-body-clean">
                            <div class="info-grid">
                                <div>
                                    <div class="info-label">Employment Type</div>
                                    <div class="info-value">
                                        {{ employee.get_work_type_display|default:"Full Time" }}
                                    </div>
                                </div>
                                <div>
                                    <div class="info-label">Department</div>
                                    <div class="info-value">
                                        {{ employee.department }}
                                    </div>
                                </div>
                                <div>
                                    <div class="info-label">Date of Joining</div>
                                    <div class="info-value">
                                        {{ employee.date_of_joining|date:"d F, Y"|default:"-" }}
                                    </div>
                                </div>
                                <div>
                                    <div class="info-label">Work Shift</div>
                                    <div class="info-value text-primary"><i class="far fa-clock me-1"></i>
                                        {{ employee.assigned_shift.name|default:"General Shift" }}</div>
                                </div>
                                <div class="border-top pt-3 mt-3">
                                    <div class="info-label">Location</div>
                                    <div class="info-value">
                                        {{ employee.location.name|default:"Head Office" }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="content-card">
                        <div class="card-header-clean">
                            <div class="card-icon"><i class="fas fa-sitemap"></i></div>Reporting Hierarchy
                        </div>
                        <div class="card-body-clean">
                            <div class="p-4 rounded-3 border bg-light text-center">
                                <div class="d-inline-flex align-items-center justify-content-center bg-white rounded-circle shadow-sm mb-3"
                                    style="width: 64px; height: 64px; border: 3px solid white;">
                                    <span class="fs-3 fw-bold text-primary">
                                        {{ employee.manager.first_name|first|default:"M" }}
                                    </span>
                                </div>
                                <h5 class="fw-bold mb-1">
                                    {{ employee.manager.get_full_name|default:"Not Assigned" }}
                                </h5>
                                <div class="text-muted small mb-3">Reporting Manager</div>
                                {% if employee.manager %}
                                <a href="mailto:{{ employee.manager.email }}"
                                    class="btn btn-sm btn-outline-primary rounded-pill px-4"><i
                                        class="fas fa-envelope me-1"></i> Contact</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DOCUMENTS TAB -->
        <div class="tab-pane fade" id="docs" role="tabpanel">
            <div class="content-card">
                <div class="card-header-clean">
                    <div class="card-icon"><i class="fas fa-folder-open"></i></div>Identity Documents
                </div>
                <div class="card-body-clean">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="doc-grid">
                            <!-- Aadhar Front -->
                            <div>
                                <div class="doc-upload-box" onclick="this.querySelector('input').click()">
                                    {% if id_proofs.aadhar_front %}
                                    <span class="badge bg-success doc-status-badge"><i class="fas fa-check"></i></span>
                                    <img src="{{ id_proofs.aadhar_front.url }}" class="doc-preview-img w-100">
                                    <div class="fw-bold text-dark">Aadhar Front</div>
                                    {% else %}
                                    <div class="py-4 text-muted"><i
                                            class="fas fa-id-card display-4 mb-3 opacity-50"></i>
                                        <div class="fw-bold">Aadhar Front</div>
                                        <div class="small">Click to upload</div>
                                    </div>
                                    {% endif %}
                                    <!-- prettier-ignore -->
                                    {% if not is_admin and id_proofs.aadhar_front %}
                                    <input type="file" name="aadhar_front" hidden disabled>
                                    {% else %}
                                    <input type="file" name="aadhar_front" hidden onchange="updateDocPreview(this)">
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Aadhar Back -->
                            <div>
                                <div class="doc-upload-box" onclick="this.querySelector('input').click()">
                                    {% if id_proofs.aadhar_back %}
                                    <span class="badge bg-success doc-status-badge"><i class="fas fa-check"></i></span>
                                    <img src="{{ id_proofs.aadhar_back.url }}" class="doc-preview-img w-100">
                                    <div class="fw-bold text-dark">Aadhar Back</div>
                                    {% else %}
                                    <div class="py-4 text-muted"><i
                                            class="fas fa-id-card display-4 mb-3 opacity-50"></i>
                                        <div class="fw-bold">Aadhar Back</div>
                                        <div class="small">Click to upload</div>
                                    </div>
                                    {% endif %}
                                    <!-- prettier-ignore -->
                                    {% if not is_admin and id_proofs.aadhar_back %}
                                    <input type="file" name="aadhar_back" hidden disabled>
                                    {% else %}
                                    <input type="file" name="aadhar_back" hidden onchange="updateDocPreview(this)">
                                    {% endif %}
                                </div>
                            </div>

                            <!-- PAN Card -->
                            <div>
                                <div class="doc-upload-box" onclick="this.querySelector('input').click()">
                                    {% if id_proofs.pan_card %}
                                    <span class="badge bg-success doc-status-badge"><i class="fas fa-check"></i></span>
                                    <img src="{{ id_proofs.pan_card.url }}" class="doc-preview-img w-100">
                                    <div class="fw-bold text-dark">PAN Card</div>
                                    {% else %}
                                    <div class="py-4 text-muted"><i
                                            class="fas fa-address-card display-4 mb-3 opacity-50"></i>
                                        <div class="fw-bold">PAN Card</div>
                                        <div class="small">Click to upload</div>
                                    </div>
                                    {% endif %}
                                    <!-- prettier-ignore -->
                                    {% if not is_admin and id_proofs.pan_card %}
                                    <input type="file" name="pan_card" hidden disabled>
                                    {% else %}
                                    <input type="file" name="pan_card" hidden onchange="updateDocPreview(this)">
                                    {% endif %}
                                </div>
                            </div>

                            <div class="text-end mt-4" style="grid-column: 1 / -1;">
                                <button type="submit" class="btn btn-primary rounded-pill px-4 shadow-sm fw-bold"><i
                                        class="fas fa-save me-1"></i> Save Changes</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) { return new bootstrap.Tooltip(tooltipTriggerEl); });

    // Responsive behavior initialization
    function initResponsiveBehavior() {
        // Handle viewport height for mobile browsers
        function setVH() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        setVH();
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);
        
        // Handle touch feedback for mobile
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
            
            // Add touch feedback to interactive elements
            const touchElements = document.querySelectorAll('.camera-btn, .nav-link, .btn, .doc-upload-box');
            touchElements.forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.classList.add('touch-active');
                });
                
                element.addEventListener('touchend', function() {
                    setTimeout(() => {
                        this.classList.remove('touch-active');
                    }, 150);
                });
            });
        }
        
        // Handle responsive navigation
        function handleResponsiveNav() {
            const navContainer = document.querySelector('.nav-container');
            const navPills = document.querySelector('.nav-pills-custom');
            
            if (window.innerWidth <= 400 && navPills) {
                navPills.classList.add('nav-stacked');
            } else if (navPills) {
                navPills.classList.remove('nav-stacked');
            }
        }
        
        handleResponsiveNav();
        window.addEventListener('resize', handleResponsiveNav);
        
        // Handle responsive cards
        function handleResponsiveCards() {
            const cards = document.querySelectorAll('.content-card');
            cards.forEach(card => {
                if (window.innerWidth <= 767) {
                    card.classList.add('mobile-card');
                } else {
                    card.classList.remove('mobile-card');
                }
            });
        }
        
        handleResponsiveCards();
        window.addEventListener('resize', handleResponsiveCards);
        
        // Handle responsive tables (if any)
        function handleResponsiveTables() {
            const tableContainers = document.querySelectorAll('.table-responsive');
            tableContainers.forEach(container => {
                const table = container.querySelector('table');
                if (table) {
                    container.addEventListener('scroll', function() {
                        if (this.scrollLeft > 0) {
                            this.classList.add('scrolled');
                        } else {
                            this.classList.remove('scrolled');
                        }
                    });
                }
            });
        }
        
        handleResponsiveTables();
    }

    // Document preview function with responsive handling
    function updateDocPreview(input) {
        if (input.files && input.files[0]) {
            var box = input.closest('.doc-upload-box');
            var reader = new FileReader();

            reader.onload = function (e) {
                // Hide any existing placeholders or images temporarily
                var placeholders = box.querySelectorAll('.text-muted, .doc-preview-img, .fw-bold.text-dark');
                placeholders.forEach(el => el.style.display = 'none');

                // Create or update preview
                var existingPreview = box.querySelector('.temp-preview');
                if (!existingPreview) {
                    var img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'doc-preview-img w-100 temp-preview';

                    var label = document.createElement('div');
                    label.className = 'fw-bold text-dark temp-label';
                    var nameMap = {
                        'aadhar_front': 'Aadhar Front',
                        'aadhar_back': 'Aadhar Back',
                        'pan_card': 'PAN Card'
                    };
                    label.innerText = nameMap[input.name] + ' (Selected)';

                    var badge = document.createElement('span');
                    badge.className = 'badge bg-info doc-status-badge';
                    badge.innerHTML = '<i class="fas fa-save"></i> Save Required';

                    // Insert elements before input
                    box.insertBefore(badge, input);
                    box.insertBefore(img, input);
                    box.insertBefore(label, input);
                } else {
                    existingPreview.src = e.target.result;
                }
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    // Handle form validation for mobile
    function handleMobileFormValidation() {
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.classList.add('is-invalid');
                        
                        // Scroll to first invalid field on mobile
                        if (window.innerWidth <= 767 && isValid === false) {
                            field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    } else {
                        field.classList.remove('is-invalid');
                    }
                });
                
                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    }
    
    // Handle responsive image loading
    function handleResponsiveImages() {
        const images = document.querySelectorAll('.profile-avatar, .doc-preview-img');
        images.forEach(img => {
            img.addEventListener('load', function() {
                this.classList.add('loaded');
            });
            
            img.addEventListener('error', function() {
                this.classList.add('error');
                // Add fallback behavior if needed
            });
        });
    }
    
    // Initialize everything when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        initResponsiveBehavior();
        handleMobileFormValidation();
        handleResponsiveImages();
        
        // Add loading states
        document.body.classList.add('page-loaded');
        
        // Handle orientation change
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 100);
        });
        
        // Initialize flexible grid behavior
        initFlexibleGrids();
        
        // Handle dynamic content resizing
        handleDynamicResize();
    });
    
    // Initialize flexible grid behavior
    function initFlexibleGrids() {
        // Handle content area resizing
        const contentAreas = document.querySelectorAll('.content-area, .card-grid, .info-grid, .address-grid, .doc-grid, .contacts-grid, .form-grid, .form-grid-2');
        
        contentAreas.forEach(area => {
            // Ensure proper box-sizing
            area.style.boxSizing = 'border-box';
            area.style.maxWidth = '100%';
            area.style.overflow = 'hidden';
            
            // Add resize observer if supported
            if (window.ResizeObserver) {
                const resizeObserver = new ResizeObserver(entries => {
                    entries.forEach(entry => {
                        const width = entry.contentRect.width;
                        const element = entry.target;
                        
                        // Remove existing responsive classes
                        element.classList.remove('grid-single-column', 'grid-two-columns', 'grid-auto');
                        
                        // Adjust grid based on available width
                        if (width < 320) {
                            element.classList.add('grid-single-column');
                            element.style.gridTemplateColumns = '1fr';
                            element.style.gap = '0.25rem';
                        } else if (width < 400) {
                            element.classList.add('grid-single-column');
                            element.style.gridTemplateColumns = '1fr';
                            element.style.gap = '0.5rem';
                        } else if (width < 600) {
                            element.classList.add('grid-two-columns');
                            // Allow natural grid behavior for small screens
                            element.style.gridTemplateColumns = '';
                            element.style.gap = '';
                        } else {
                            element.classList.add('grid-auto');
                            // Reset to CSS-defined behavior
                            element.style.gridTemplateColumns = '';
                            element.style.gap = '';
                        }
                        
                        // Ensure all child elements don't overflow
                        const children = element.children;
                        for (let child of children) {
                            child.style.minWidth = '0';
                            child.style.maxWidth = '100%';
                            child.style.boxSizing = 'border-box';
                        }
                    });
                });
                
                resizeObserver.observe(area);
            }
        });
        
        // Handle profile layout
        const profileLayout = document.querySelector('.profile-layout');
        if (profileLayout && window.ResizeObserver) {
            const profileObserver = new ResizeObserver(entries => {
                entries.forEach(entry => {
                    const width = entry.contentRect.width;
                    
                    if (width < 768) {
                        entry.target.classList.add('mobile-layout');
                    } else {
                        entry.target.classList.remove('mobile-layout');
                    }
                });
            });
            
            profileObserver.observe(profileLayout);
        }
        
        // Handle text overflow in all grid items
        handleTextOverflow();
    }
    
    // Handle text overflow and word wrapping
    function handleTextOverflow() {
        const textElements = document.querySelectorAll('.info-value, .address-text, .profile-name, .profile-role');
        
        textElements.forEach(element => {
            element.style.wordWrap = 'break-word';
            element.style.overflowWrap = 'break-word';
            element.style.hyphens = 'auto';
            element.style.maxWidth = '100%';
            element.style.overflow = 'hidden';
        });
    }
    
    // Handle dynamic content resizing
    function handleDynamicResize() {
        // Debounced resize handler
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Recalculate grid layouts
                const grids = document.querySelectorAll('.content-area, .card-grid, .info-grid, .address-grid, .doc-grid, .contacts-grid');
                grids.forEach(grid => {
                    // Force reflow to recalculate grid
                    const display = grid.style.display;
                    grid.style.display = 'none';
                    grid.offsetHeight; // Trigger reflow
                    grid.style.display = display || '';
                    
                    // Ensure proper sizing
                    grid.style.maxWidth = '100%';
                    grid.style.overflow = 'hidden';
                    
                    // Handle child elements
                    const children = grid.children;
                    for (let child of children) {
                        child.style.minWidth = '0';
                        child.style.maxWidth = '100%';
                        child.style.boxSizing = 'border-box';
                    }
                });
                
                // Update navigation layout
                updateNavigationLayout();
                
                // Update card heights
                equalizeCardHeights();
                
                // Handle text overflow
                handleTextOverflow();
                
                // Force viewport recalculation on mobile
                if (window.innerWidth <= 768) {
                    document.body.style.overflow = 'hidden';
                    setTimeout(() => {
                        document.body.style.overflow = '';
                    }, 10);
                }
            }, 150);
        });
        
        // Handle orientation change specifically
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                // Force complete recalculation
                const allGrids = document.querySelectorAll('.content-area, .card-grid, .info-grid, .address-grid, .doc-grid, .contacts-grid, .form-grid, .form-grid-2');
                allGrids.forEach(grid => {
                    grid.style.gridTemplateColumns = '';
                    grid.style.gap = '';
                    
                    // Trigger resize observer if available
                    if (window.ResizeObserver) {
                        const event = new Event('resize');
                        window.dispatchEvent(event);
                    }
                });
            }, 200);
        });
    }
    
    // Update navigation layout based on screen size
    function updateNavigationLayout() {
        const navContainer = document.querySelector('.nav-container');
        const navPills = document.querySelector('.nav-pills-custom');
        
        if (!navPills) return;
        
        const containerWidth = navContainer ? navContainer.offsetWidth : window.innerWidth;
        
        if (containerWidth < 400) {
            navPills.classList.add('nav-vertical');
        } else {
            navPills.classList.remove('nav-vertical');
        }
    }
    
    // Equalize card heights in grid layouts
    function equalizeCardHeights() {
        const cardGrids = document.querySelectorAll('.card-grid');
        
        cardGrids.forEach(grid => {
            const cards = grid.querySelectorAll('.content-card');
            let maxHeight = 0;
            
            // Reset heights
            cards.forEach(card => {
                card.style.height = 'auto';
            });
            
            // Find max height
            cards.forEach(card => {
                const height = card.offsetHeight;
                if (height > maxHeight) {
                    maxHeight = height;
                }
            });
            
            // Apply max height only on larger screens
            if (window.innerWidth > 767) {
                cards.forEach(card => {
                    card.style.height = maxHeight + 'px';
                });
            }
        });
    }
    
    // Performance optimization for scroll events
    let ticking = false;
    function updateOnScroll() {
        // Handle any scroll-based responsive behavior here
        ticking = false;
    }
    
    window.addEventListener('scroll', function() {
        if (!ticking) {
            requestAnimationFrame(updateOnScroll);
            ticking = true;
        }
    });
    
    // Add CSS classes for JavaScript-enhanced responsive behavior
    document.documentElement.classList.add('js-enabled');
    
    // Detect if device supports hover
    if (window.matchMedia('(hover: hover)').matches) {
        document.documentElement.classList.add('hover-supported');
    } else {
        document.documentElement.classList.add('touch-only');
    }
</script>

<style>
    /* Additional responsive enhancements via JavaScript */
    .touch-device .camera-btn.touch-active {
        transform: scale(0.95);
        background: rgba(30, 41, 59, 0.8);
    }
    
    .touch-device .nav-link.touch-active {
        background: rgba(99, 102, 241, 0.1);
    }
    
    .touch-device .btn.touch-active {
        transform: scale(0.98);
    }
    
    .touch-device .doc-upload-box.touch-active {
        border-color: var(--primary-color);
        background: rgba(99, 102, 241, 0.05);
    }
    
    .nav-stacked {
        flex-direction: column !important;
        width: 100% !important;
    }
    
    .nav-stacked .nav-link {
        width: 100% !important;
        margin-bottom: 0.25rem !important;
        text-align: center !important;
    }
    
    .nav-vertical {
        flex-direction: column !important;
        align-items: stretch !important;
    }
    
    .nav-vertical .nav-link {
        text-align: center !important;
        margin-bottom: 0.5rem !important;
    }
    
    .mobile-card {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
    }
    
    .profile-avatar.loaded {
        opacity: 1;
        transition: opacity 0.3s ease;
    }
    
    .profile-avatar.error {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .profile-avatar.error::after {
        content: '!';
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
    }
    
    .page-loaded .fade-in-up {
        animation-play-state: running;
    }
    
    /* Mobile layout adjustments */
    .profile-layout.mobile-layout {
        text-align: center;
    }
    
    .profile-layout.mobile-layout .profile-avatar-wrapper {
        margin: 0 auto 1rem;
    }
    
    .profile-layout.mobile-layout .nav-container {
        justify-content: center;
        margin-top: 1rem;
    }
    
    /* Grid responsive classes */
    .grid-single-column {
        grid-template-columns: 1fr !important;
        gap: 0.5rem !important;
    }
    
    .grid-two-columns {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.75rem !important;
    }
    
    .grid-auto {
        /* Let CSS handle the grid */
    }
    
    /* Ultra-small screen overrides */
    @media (max-width: 320px) {
        .grid-single-column,
        .grid-two-columns,
        .grid-auto {
            grid-template-columns: 1fr !important;
            gap: 0.25rem !important;
        }
    }
    
    /* Flexible container system */
    .flex-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
    }
    
    .flex-container > * {
        flex: 1 1 auto;
        min-width: 0;
        max-width: 100%;
    }
    
    @media (max-width: 768px) {
        .flex-container {
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .flex-container > * {
            flex: none;
            width: 100%;
        }
    }
    
    @media (max-width: 320px) {
        .flex-container {
            gap: 0.5rem;
        }
    }
    
    /* Overflow protection */
    .overflow-safe {
        overflow: hidden;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
        max-width: 100%;
        box-sizing: border-box;
    }
    
    /* Text truncation utilities */
    .text-truncate-responsive {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    @media (max-width: 576px) {
        .text-truncate-responsive {
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
    }
    
    /* Form validation styles */
    .form-control.is-invalid,
    .form-select.is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    }
    
    /* Loading states */
    .profile-avatar {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .profile-avatar[src] {
        opacity: 1;
    }
    
    /* Hover support detection */
    .hover-supported .camera-btn:hover {
        background: #374151;
        transform: scale(1.1);
    }
    
    .touch-only .camera-btn {
        min-width: 24px;
        min-height: 24px;
    }
    
    /* Enhanced grid responsiveness */
    @media (max-width: 1200px) {
        .content-area {
            grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
        }
        
        .card-grid {
            grid-template-columns: repeat(auto-fit, minmax(min(220px, 100%), 1fr));
        }
    }
    
    @media (max-width: 992px) {
        .content-area {
            grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
        }
        
        .card-grid {
            grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
        }
        
        .info-grid {
            grid-template-columns: repeat(auto-fit, minmax(min(180px, 100%), 1fr));
        }
    }
    
    @media (max-width: 768px) {
        .content-area,
        .card-grid,
        .info-grid,
        .address-grid,
        .doc-grid,
        .contacts-grid,
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .form-grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(min(120px, 100%), 1fr));
        }
    }
    
    @media (max-width: 575px) {
        .form-grid-2 {
            grid-template-columns: 1fr;
        }
        
        .doc-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Container queries support */
    @supports (container-type: inline-size) {
        .content-area {
            container-type: inline-size;
        }
        
        @container (max-width: 600px) {
            .content-area {
                grid-template-columns: 1fr;
            }
        }
        
        @container (max-width: 400px) {
            .card-grid,
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    }
    
    /* Fallback for browsers without container query support */
    @supports not (container-type: inline-size) {
        .content-area,
        .card-grid,
        .info-grid,
        .address-grid,
        .doc-grid,
        .contacts-grid,
        .form-grid,
        .form-grid-2 {
            /* Use more conservative grid approach */
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .content-area > *,
        .card-grid > *,
        .info-grid > *,
        .address-grid > *,
        .doc-grid > *,
        .contacts-grid > *,
        .form-grid > *,
        .form-grid-2 > * {
            flex: 1 1 auto;
            min-width: 250px;
            max-width: 100%;
        }
        
        @media (max-width: 768px) {
            .content-area > *,
            .card-grid > *,
            .info-grid > *,
            .address-grid > *,
            .doc-grid > *,
            .contacts-grid > *,
            .form-grid > *,
            .form-grid-2 > * {
                flex: none;
                width: 100%;
                min-width: 0;
            }
        }
    }
    
    /* CSS Grid support check */
    @supports (display: grid) {
        /* Modern grid approach - already defined above */
    }
    
    @supports not (display: grid) {
        /* Flexbox fallback for very old browsers */
        .content-area,
        .card-grid,
        .info-grid,
        .address-grid,
        .doc-grid,
        .contacts-grid,
        .form-grid,
        .form-grid-2 {
            display: flex !important;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .content-area > *,
        .card-grid > *,
        .info-grid > *,
        .address-grid > *,
        .doc-grid > *,
        .contacts-grid > *,
        .form-grid > *,
        .form-grid-2 > * {
            flex: 1 1 300px;
            max-width: 100%;
        }
    }
    
    /* min() function support check */
    @supports not (width: min(100px, 100%)) {
        .content-area {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .card-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        .info-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .address-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        
        .doc-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .contacts-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        .form-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .form-grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
    }
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        .touch-device .camera-btn.touch-active,
        .touch-device .btn.touch-active {
            transform: none;
        }
        
        .profile-avatar {
            transition: none;
        }
        
        .fade-in-up {
            animation: none !important;
        }
    }
</style>
{% endblock %}